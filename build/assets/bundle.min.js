document.addEventListener('DOMContentLoaded',function(){console.log('Dropdown fix loaded');function initializeDropdowns(){document.querySelectorAll('.dropdown-toggle').forEach(element=>{element.removeEventListener('click',handleDropdownClick)});document.querySelectorAll('.dropdown-toggle').forEach(element=>{element.addEventListener('click',handleDropdownClick)});const userAvatar=document.querySelector('.user-avatar.dropdown-toggle');if(userAvatar){userAvatar.style.cursor='pointer';userAvatar.removeEventListener('click',handleDropdownClick);userAvatar.addEventListener('click',handleDropdownClick)}}function handleDropdownClick(event){event.preventDefault();event.stopPropagation();const element=this;console.log('Dropdown clicked',element);document.querySelectorAll('.dropdown.show').forEach(dropdown=>{if(dropdown!==element.closest('.dropdown')){dropdown.classList.remove('show')}});const dropdownElement=element.closest('.dropdown');if(dropdownElement){dropdownElement.classList.toggle('show');const menu=dropdownElement.querySelector('.dropdown-menu');if(menu&&dropdownElement.classList.contains('show')){menu.style.display='block';menu.style.visibility='visible';menu.style.opacity='1';menu.style.pointerEvents='auto';menu.style.zIndex='9999'}}}document.addEventListener('click',function(event){if(!event.target.closest('.dropdown')){document.querySelectorAll('.dropdown.show').forEach(dropdown=>{dropdown.classList.remove('show');const menu=dropdown.querySelector('.dropdown-menu');if(menu){menu.style.display='';menu.style.visibility='';menu.style.opacity='';menu.style.pointerEvents=''}})}});initializeDropdowns();const observer=new MutationObserver(function(mutations){initializeDropdowns()});const header=document.querySelector('header');if(header){observer.observe(header,{childList:true,subtree:true})}});;alert("fdsfsd");document.addEventListener("DOMContentLoaded",function(){var forms=document.querySelectorAll(".dynamicForm");forms.forEach(function(form){var submitButton=form.querySelector('button[type="submit"]');form.addEventListener("input",function(){var areFieldsFilled=Array.from(form.elements).every(function(element){return(!element.required||(element.type!=="checkbox"&&element.value.trim()!==""))});submitButton.disabled=!areFieldsFilled})})});;document.addEventListener('DOMContentLoaded',function(){setTimeout(function(){console.log('Initializing simple dropdown fix...');const userAvatarLinks=document.querySelectorAll('.user-avatar,.notification-item a');userAvatarLinks.forEach(function(avatar){if(!avatar)return;console.log('Setting up avatar click:',avatar);avatar.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();console.log('Avatar clicked');let dropdownMenu=null;const dropdownContainer=avatar.closest('.dropdown');if(dropdownContainer){dropdownMenu=dropdownContainer.querySelector('.dropdown-menu')}if(!dropdownMenu){console.log('No dropdown menu found');return}console.log('Found dropdown menu:',dropdownMenu);const allDropdowns=document.querySelectorAll('.dropdown-menu');allDropdowns.forEach(function(menu){if(menu!==dropdownMenu){menu.style.display='none';menu.classList.remove('show')}});const isVisible=dropdownMenu.style.display==='block'||dropdownMenu.classList.contains('show');if(isVisible){dropdownMenu.style.display='none';dropdownMenu.classList.remove('show');console.log('Dropdown closed')}else{dropdownMenu.style.display='block';dropdownMenu.classList.add('show');console.log('Dropdown opened')}})});document.addEventListener('click',function(e){if(!e.target.closest('.dropdown')){const allDropdowns=document.querySelectorAll('.dropdown-menu');allDropdowns.forEach(function(menu){menu.style.display='none';menu.classList.remove('show')})}});document.addEventListener('keydown',function(e){if(e.key==='Escape'){const allDropdowns=document.querySelectorAll('.dropdown-menu');allDropdowns.forEach(function(menu){menu.style.display='none';menu.classList.remove('show')})}})},500)});;document.addEventListener('DOMContentLoaded',function(){console.log('Header dropdown fix initializing...');setTimeout(function(){initializeDropdowns()},100);function initializeDropdowns(){const dropdownTriggers=document.querySelectorAll('[data-bs-toggle="dropdown"]');console.log('Found dropdown triggers:',dropdownTriggers.length);dropdownTriggers.forEach(function(trigger,index){if(!trigger){console.warn('Null trigger found at index:',index);return}console.log('Setting up trigger:',trigger);trigger.removeEventListener('click',handleDropdownClick);trigger.addEventListener('click',handleDropdownClick)});document.removeEventListener('click',handleOutsideClick);document.addEventListener('click',handleOutsideClick);document.removeEventListener('keydown',handleEscapeKey);document.addEventListener('keydown',handleEscapeKey)}function handleDropdownClick(e){e.preventDefault();e.stopPropagation();const trigger=e.currentTarget;if(!trigger){console.error('No trigger found in click event');return}console.log('Dropdown clicked:',trigger);let dropdown=null;if(trigger.nextElementSibling&&trigger.nextElementSibling.classList&&trigger.nextElementSibling.classList.contains('dropdown-menu')){dropdown=trigger.nextElementSibling}else if(trigger.parentElement&&trigger.parentElement.nextElementSibling&&trigger.parentElement.nextElementSibling.classList&&trigger.parentElement.nextElementSibling.classList.contains('dropdown-menu')){dropdown=trigger.parentElement.nextElementSibling}else if(trigger.parentElement){dropdown=trigger.parentElement.querySelector('.dropdown-menu')}else{const dropdownContainer=trigger.closest('.dropdown');if(dropdownContainer){dropdown=dropdownContainer.querySelector('.dropdown-menu')}}if(!dropdown){console.error('No dropdown menu found for trigger:',trigger);return}console.log('Found dropdown menu:',dropdown);const isShown=dropdown.classList.contains('show')||dropdown.classList.contains('d-block');closeAllDropdowns();if(!isShown){dropdown.classList.add('show');dropdown.style.display='block';trigger.setAttribute('aria-expanded','true');console.log('Dropdown opened')}else{dropdown.classList.remove('show');dropdown.style.display='none';trigger.setAttribute('aria-expanded','false');console.log('Dropdown closed')}}function handleOutsideClick(e){if(!e.target.closest('.dropdown')){closeAllDropdowns()}}function handleEscapeKey(e){if(e.key==='Escape'){closeAllDropdowns()}}function closeAllDropdowns(){const allDropdowns=document.querySelectorAll('.dropdown-menu');allDropdowns.forEach(function(menu){if(menu&&menu.classList){menu.classList.remove('show');menu.style.display='none'}});const allTriggers=document.querySelectorAll('[data-bs-toggle="dropdown"]');allTriggers.forEach(function(trigger){if(trigger&&trigger.setAttribute){trigger.setAttribute('aria-expanded','false')}})}window.reinitializeDropdowns=initializeDropdowns});function checkBootstrap(){if(typeof bootstrap==='undefined'){console.warn('Bootstrap JS is not loaded properly');return false}return true}function initializeDropdowns(){checkBootstrap();const dropdowns=document.querySelectorAll('.dropdown-toggle');dropdowns.forEach(function(dropdown){if(typeof bootstrap!=='undefined'&&bootstrap.Dropdown){new bootstrap.Dropdown(dropdown)}})};class LazyContentLoader{constructor(options={}){this.options={rootMargin:'50px',threshold:0.01,placeholderType:'card',...options};this.observer=null;this.loadedElements=new Set();this.init()}init(){this.observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting&&!this.loadedElements.has(entry.target)){this.loadContent(entry.target)}})},{rootMargin:this.options.rootMargin,threshold:this.options.threshold});this.observeElements()}observeElements(){const elements=document.querySelectorAll('[data-lazy-load]');elements.forEach(element=>{this.showPlaceholder(element);this.observer.observe(element)})}showPlaceholder(element){const type=element.dataset.placeholderType||this.options.placeholderType;const count=parseInt(element.dataset.placeholderCount)||1;const columns=parseInt(element.dataset.placeholderColumns)||4;const placeholderHtml=this.getPlaceholderHtml(type,count,columns);element.innerHTML=placeholderHtml}getPlaceholderHtml(type,count,columns){let html=`<div class="placeholder-grid" style="display:grid;grid-template-columns:repeat(${columns},1fr);gap:20px;">`;for(let i=0;i<count;i++){html+=this.getPlaceholderTemplate(type)}html+='</div>';return html}getPlaceholderTemplate(type){const templates={'news-card':`<div class="placeholder-news-card" style="border:1px solid var(--border-color,#e2e8f0);border-radius:8px;padding:20px;background:var(--surface,#ffffff);"><div class="skeleton skeleton-animated" style="height:24px;width:85%;margin-bottom:8px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:16px;width:100%;margin-bottom:8px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:16px;width:90%;border-radius:4px;"></div></div>`,'post-card':`<div class="placeholder-post-card" style="border:1px solid var(--border-color,#e2e8f0);border-radius:12px;overflow:hidden;background:var(--surface,#ffffff);"><div class="skeleton skeleton-animated" style="width:100%;height:180px;"></div><div style="padding:20px;"><div class="skeleton skeleton-animated" style="height:20px;width:90%;margin-bottom:8px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:14px;width:100%;margin-bottom:6px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:14px;width:80%;border-radius:4px;"></div></div></div>`,'school-card':`<div class="placeholder-school-card" style="padding:20px;background:var(--surface,#ffffff);border:1px solid var(--border-color,#e2e8f0);border-radius:8px;"><div class="skeleton skeleton-animated" style="height:24px;width:70%;margin-bottom:12px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:16px;width:200px;margin-bottom:8px;border-radius:4px;"></div><div class="skeleton skeleton-animated" style="height:16px;width:150px;border-radius:4px;"></div></div>`};return templates[type]||templates['news-card']}async loadContent(element){const url=element.dataset.lazyLoad;const type=element.dataset.contentType||'html';try{this.loadedElements.add(element);if(element.dataset.simulateDelay){await new Promise(resolve=>setTimeout(resolve,1000))}const response=await fetch(url);if(!response.ok){throw new Error('Failed to load content')}if(type==='json'){const data=await response.json();this.renderContent(element,data)}else{const html=await response.text();this.replaceContent(element,html)}}catch(error){console.error('Error loading content:',error);this.showError(element)}}renderContent(element,data){const renderer=element.dataset.renderer;if(renderer&&window[renderer]){const html=window[renderer](data);this.replaceContent(element,html)}else{console.error('No renderer found for:',renderer)}}replaceContent(element,html){element.style.opacity='0.5';setTimeout(()=>{element.innerHTML=html;element.style.opacity='1';element.dispatchEvent(new CustomEvent('content-loaded',{bubbles:true,detail:{element}}))},200)}showError(element){element.innerHTML=`<div style="padding:40px;text-align:center;color:var(--text-secondary,#666);"><i class="fas fa-exclamation-circle" style="font-size:48px;margin-bottom:16px;opacity:0.5;"></i><p>Не удалось загрузить контент</p><button onclick="lazyLoader.retry(this.closest('[data-lazy-load]'))" style="margin-top:16px;padding:8px 16px;background:var(--primary-color,#28a745);color:white;border:none;border-radius:4px;cursor:pointer;">Повторить</button></div>`}retry(element){this.loadedElements.delete(element);this.showPlaceholder(element);setTimeout(()=>this.loadContent(element),100)}refresh(){this.observeElements()}disconnect(){if(this.observer){this.observer.disconnect()}}}document.addEventListener('DOMContentLoaded',()=>{window.lazyLoader=new LazyContentLoader()});if(!document.getElementById('skeleton-styles')){const style=document.createElement('style');style.id='skeleton-styles';style.innerHTML=` .skeleton{background:linear-gradient(90deg,var(--skeleton-base,#e2e8f0)25%,var(--skeleton-highlight,#edf2f7)50%,var(--skeleton-base,#e2e8f0)75%);background-size:200% 100%}.skeleton-animated{animation:skeleton-loading 1.4s ease-in-out infinite}@keyframes skeleton-loading{0%{background-position:200% 0}100%{background-position:-200% 0}}[data-theme="dark"] .skeleton{background:linear-gradient(90deg,var(--skeleton-base,#374151)25%,var(--skeleton-highlight,#4b5563)50%,var(--skeleton-base,#374151)75%);background-size:200% 100%}`;document.head.appendChild(style)};document.addEventListener('DOMContentLoaded',function(){const lazyImages=document.querySelectorAll('img[data-src]');if('IntersectionObserver' in window){const imageObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;img.classList.add('loaded');if(img.dataset.srcset){img.srcset=img.dataset.srcset}imageObserver.unobserve(img)}})},{rootMargin:'50px 0px',threshold:0.01});lazyImages.forEach(function(img){imageObserver.observe(img)})}else{let lazyLoadThrottleTimeout;function lazyLoad(){if(lazyLoadThrottleTimeout){clearTimeout(lazyLoadThrottleTimeout)}lazyLoadThrottleTimeout=setTimeout(function(){const scrollTop=window.pageYOffset;lazyImages.forEach(function(img){if(img.offsetTop<(window.innerHeight+scrollTop)){img.src=img.dataset.src;img.classList.add('loaded');if(img.dataset.srcset){img.srcset=img.dataset.srcset}}});if(lazyImages.length==0){document.removeEventListener("scroll",lazyLoad);window.removeEventListener("resize",lazyLoad);window.removeEventListener("orientationChange",lazyLoad)}},20)}document.addEventListener("scroll",lazyLoad);window.addEventListener("resize",lazyLoad);window.addEventListener("orientationChange",lazyLoad)}});document.addEventListener('DOMContentLoaded',function(){const lazyBackgrounds=document.querySelectorAll('[data-bg]');if('IntersectionObserver' in window){const bgObserver=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){const element=entry.target;element.style.backgroundImage=`url(${element.dataset.bg})`;element.classList.add('bg-loaded');bgObserver.unobserve(element)}})});lazyBackgrounds.forEach(function(bg){bgObserver.observe(bg)})}});;document.addEventListener("DOMContentLoaded",function(){console.log("DOM is ready");const regionLinks=document.querySelectorAll(".region-link");regionLinks.forEach(function(regionLink){regionLink.addEventListener("click",function(event){event.preventDefault();const clickedRegion=regionLink.closest(".region");fetch("areas.php?region_id="+regionLink.getAttribute("data-region-id")).then((response)=>response.text()).then((data)=>{clickedRegion.innerHTML+=data;regionLink.classList.add("disabled");const allRegions=document.querySelectorAll(".region");allRegions.forEach(function(otherRegion){if(otherRegion!==clickedRegion){otherRegion.classList.toggle("d-none");console.log("Hidden class toggled")}});const showAllRegionsLink=document.getElementById("showAllRegionsLink");showAllRegionsLink.classList.remove("d-none");const heading=document.querySelector(".text-5xl.font-bold.mb-4.text-center");heading.classList.add("d-none")}).catch((error)=>console.error("Error fetching areas:",error))})});const showAllRegionsLink=document.getElementById("showAllRegionsLink");showAllRegionsLink.addEventListener("click",function(event){event.preventDefault();const clickedRegion=document.querySelector(".region:not(.d-none)");clickedRegion.innerHTML="";regionLinks.forEach(function(link){link.classList.remove("disabled")});const allRegions=document.querySelectorAll(".region");allRegions.forEach(function(region){region.classList.remove("d-none")});showAllRegionsLink.classList.add("d-none");const heading=document.querySelector(".text-5xl.font-bold.mb-4.text-center");heading.classList.remove("d-none")})});;